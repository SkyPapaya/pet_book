<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skypapaya.mapper.NotificationMapper">

    <!-- comment notifications: others comment on your posts -->
    <select id="selectCommentNotifications" resultType="com.skypapaya.vo.NotificationVO">
        SELECT
            c.id,
            'comment' AS type,
            c.user_id AS actorId,
            u.nickname AS actorName,
            u.avatar AS actorAvatar,
            p.id AS postId,
            p.title AS postTitle,
            c.content AS content,
            c.create_time AS createdAt
        FROM comment c
        JOIN post p ON c.post_id = p.id
        LEFT JOIN user u ON c.user_id = u.id
        WHERE p.user_id = #{userId}
          AND c.user_id &lt;&gt; #{userId}
        ORDER BY c.create_time DESC
        LIMIT #{offset}, #{limit}
    </select>

    <!-- like notifications: others like your posts -->
    <select id="selectLikeNotifications" resultType="com.skypapaya.vo.NotificationVO">
        SELECT
            i.id,
            'like' AS type,
            i.user_id AS actorId,
            u.nickname AS actorName,
            u.avatar AS actorAvatar,
            p.id AS postId,
            p.title AS postTitle,
            NULL AS content,
            i.create_time AS createdAt
        FROM interaction i
        JOIN post p ON i.target_id = p.id
        LEFT JOIN user u ON i.user_id = u.id
        WHERE i.target_type = 1
          AND i.type = 1
          AND p.user_id = #{userId}
          AND i.user_id &lt;&gt; #{userId}
        ORDER BY i.create_time DESC
        LIMIT #{offset}, #{limit}
    </select>

    <!-- follow notifications: others follow you -->
    <select id="selectFollowNotifications" resultType="com.skypapaya.vo.NotificationVO">
        SELECT
            f.id,
            'follow' AS type,
            f.follower_id AS actorId,
            u.nickname AS actorName,
            u.avatar AS actorAvatar,
            NULL AS postId,
            NULL AS postTitle,
            NULL AS content,
            f.create_time AS createdAt
        FROM follow f
        LEFT JOIN user u ON f.follower_id = u.id
        WHERE f.followee_id = #{userId}
        ORDER BY f.create_time DESC
        LIMIT #{offset}, #{limit}
    </select>

</mapper>

